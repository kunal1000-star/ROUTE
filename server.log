
> nextn@0.1.0 dev
> next dev --turbopack

 ⚠ Port 3000 is in use by an unknown process, using available port 3003 instead.
   ▲ Next.js 15.5.6 (Turbopack)
   - Local:        http://localhost:3003
   - Network:      http://10.0.4.81:3003
   - Environments: .env
   - Experiments (use with caution):
     · serverActions

 ✓ Starting...
 ✓ Ready in 1294ms
 ○ Compiling / ...
 ✓ Compiled / in 7.5s
 GET / 200 in 8119ms
 ○ Compiling /api/auth/[...nextauth] ...
 GET /favicon.ico?favicon.7ed73651.ico 200 in 1874ms
 ✓ Compiled /api/auth/[...nextauth] in 2.2s
 GET /api/auth/session 200 in 3844ms
 ○ Compiling /api/chat ...
 ✓ Compiled /api/chat in 1148ms
[req-1762439507862-697a37i5t] Processing query for user anonymous, conversation conv-1762439507862
Performing health check on all providers...
✅ groq: healthy (17ms)
✅ gemini: healthy (795ms)
✅ cerebras: healthy (342ms)
✅ cohere: healthy (308ms)
✅ mistral: healthy (351ms)
✅ openrouter: healthy (67ms)
Healthy providers: groq, gemini, cerebras, cohere, mistral, openrouter
[req-1762439507862-697a37i5t] Query detected as: general
[req-1762439507862-697a37i5t] Available providers: groq, gemini, cerebras, cohere, mistral, openrouter
[req-1762439507862-697a37i5t] Trying provider: groq
[req-1762439507862-697a37i5t] Provider groq failed: Error: Groq authentication failed - check API key
    at GroqClient.handleError (src/lib/ai/providers/groq-client.ts:378:14)
    at GroqClient.chat (src/lib/ai/providers/groq-client.ts:114:22)
    at async AIServiceManager.callProvider (src/lib/ai/ai-service-manager-unified.ts:401:20)
    at async AIServiceManager.processQuery (src/lib/ai/ai-service-manager-unified.ts:123:28)
    at async POST (src/app/api/chat/route.ts:147:20)
  376 |     
  377 |     if (error.message?.includes('401') || error.message?.includes('403')) {
> 378 |       return new Error('Groq authentication failed - check API key');
      |              ^
  379 |     }
  380 |     
  381 |     return new Error(`Groq error: ${error.message} (attempt ${attempt}/${this.maxRetries})`);
[req-1762439507862-697a37i5t] Trying provider: gemini
[req-1762439507862-697a37i5t] Provider gemini failed: Error: Gemini error: Gemini API error: 404 Not Found - models/gemini-1.5-flash is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods. (attempt 3/3)
    at GeminiClient.handleError (src/lib/ai/providers/gemini-client.ts:471:12)
    at GeminiClient.chat (src/lib/ai/providers/gemini-client.ts:177:22)
    at async AIServiceManager.callProvider (src/lib/ai/ai-service-manager-unified.ts:409:20)
    at async AIServiceManager.processQuery (src/lib/ai/ai-service-manager-unified.ts:123:28)
    at async POST (src/app/api/chat/route.ts:147:20)
  469 |     }
  470 |     
> 471 |     return new Error(`Gemini error: ${error.message} (attempt ${attempt}/${this.maxRetries})`);
      |            ^
  472 |   }
  473 |
  474 |   /**
[req-1762439507862-697a37i5t] Trying provider: cerebras
[req-1762439507862-697a37i5t] Success with provider: cerebras
 POST /api/chat 200 in 20412ms
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
 ✓ Compiled /api/chat/general/send in 326ms
Incoming request headers: Headers {
  host: 'localhost:3003',
  'user-agent': 'curl/8.5.0',
  accept: '*/*',
  'content-type': 'application/json',
  'content-length': '95',
  'x-forwarded-host': 'localhost:3003',
  'x-forwarded-port': '3003',
  'x-forwarded-proto': 'http',
  'x-forwarded-for': '::1'
}
Parsed request body: {
  userId: 'test-user-123',
  message: 'Hello, this is a test message!',
  chatType: 'general'
}
UserId: test-user-123
ConversationId: undefined
Message: Hello, this is a test message!
ChatType: general
Chat send error: Error: Failed to create conversation: invalid input syntax for type uuid: "test-user-123"
    at POST (src/app/api/chat/general/send/route.ts:79:15)
  77 |
  78 |       if (error) {
> 79 |         throw new Error(`Failed to create conversation: ${error.message}`);
     |               ^
  80 |       }
  81 |
  82 |       finalConversationId = newConversation.id;
 POST /api/chat/general/send 500 in 1326ms
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
 ✓ Compiled /api/chat/study-assistant/send in 228ms
Study assistant send error: Error: Failed to create conversation: new row violates row-level security policy for table "chat_conversations"
    at POST (src/app/api/chat/study-assistant/send/route.ts:39:15)
  37 |
  38 |       if (error) {
> 39 |         throw new Error(`Failed to create conversation: ${error.message}`);
     |               ^
  40 |       }
  41 |
  42 |       finalConversationId = newConversation.id;
 POST /api/chat/study-assistant/send 500 in 1015ms
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
Failed to insert API usage logs: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'fallback_used' column of 'api_usage_logs' in the schema cache"
}
